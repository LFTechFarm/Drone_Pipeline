# ğŸ›°ï¸ UAV Microplot Extraction & Vegetation Index Pipeline

This repository provides a complete Python/Jupyter workflow to:

1.  ğŸ¯ **Crop and rotate microplots** from RGB and multispectral (MSP)
    orthomosaics.\
2.  ğŸ“¦ **Generate stacked RGB+MSP microplot cubes**.\
3.  ğŸŒ± **Compute vegetation indices** (NDVI, NDRE, GNDVI, SAVI, MSAVI,
    EVI, etc.).\
4.  ğŸ“Š **Extract summary statistics** (mean, median, min, max, std).\
5.  ğŸ–¼ï¸ **Visualize results** for quality control and trait analysis.

------------------------------------------------------------------------

## ğŸ“ Directory Structure

**Input:**

    PBM_1.7.2_datasetsM172_RGB_MS/
    â”œâ”€â”€ UAV_2306_RGB_barley_plots.tif
    â”œâ”€â”€ UAV_2306_MSP_barley_plots.tif
    â””â”€â”€ plots_final.geojson

**Outputs generated by the notebook:**

    microplots_output/
    â”œâ”€â”€ rgb/          # Rotated RGB microplots
    â”œâ”€â”€ msp/          # Rotated MSP microplots
    â”œâ”€â”€ stack/        # Stacked RGB+MSP cubes
    â””â”€â”€ indices/
        â””â”€â”€ microplots_indices_summary.csv

------------------------------------------------------------------------

## ğŸ›  Installation

### Conda (recommended)

``` bash
conda create -n microplots python=3.11
conda activate microplots
conda install -c conda-forge numpy pandas geopandas rasterio shapely scipy scikit-image tqdm matplotlib
```

### Pip

``` bash
pip install numpy pandas geopandas rasterio shapely scipy scikit-image tqdm matplotlib
```

------------------------------------------------------------------------

## âš™ï¸ Workflow Overview

### ğŸ”¹ 1. Microplot Cropping & Rotation

-   Reprojects polygons\
-   Extracts central percentage of plot (`CENTER_PERCENT`)\
-   Computes orientation\
-   Crops and rotates RGB/MSP\
-   Builds 8â€‘band stack:

```{=html}
<!-- -->
```
    1. R
    2. G
    3. B
    4. Blue
    5. Green
    6. Red
    7. Red Edge
    8. NIR

------------------------------------------------------------------------

### ğŸ”¹ 2. Vegetation Indices

Computed indices include:

-   ğŸŒ¿ NDVI\
-   ğŸŒ¾ NDRE\
-   ğŸƒ GNDVI\
-   ğŸŸ¢ SAVI / OSAVI\
-   ğŸŒ± MSAVI\
-   ğŸŒ EVI / EVI2\
-   ğŸ’§ NDWI\
-   ğŸ”¥ NDMI\
-   ğŸŒˆ VARI\
-   â˜˜ï¸ MCARI\
-   ğŸŒŸ MTVI2

Statistics per microplot:

-   Mean\
-   Median\
-   Min\
-   Max\
-   Std

Exported to:

    microplots_output/indices/microplots_indices_summary.csv

------------------------------------------------------------------------

### ğŸ”¹ 3. Visualization

The notebook provides a helper function:

    plot_index_stats(df)

This produces bar charts for all indices across all microplots.

------------------------------------------------------------------------

## ğŸ”§ Customization

-   **Plot naming:**\
    `PLOT_ID_FIELD = "id"`

-   **Central area cropping:**\
    `CENTER_PERCENT = 50.0`

-   **Add new vegetation indices:**\
    Edit `INDEX_FUNCS`

-   **Sensor with different band order:**\
    Update `MSP_BAND_INDEX`

------------------------------------------------------------------------

## âš ï¸ Notes

-   GeoJSON is automatically reprojected to match raster CRS.\
-   Invalid pixels cleaned using a "sum of bands \> 0" mask.\
-   Rotation uses `expand=True` to avoid clipping.

------------------------------------------------------------------------

## ğŸ“„ License

Add your license here.

------------------------------------------------------------------------
